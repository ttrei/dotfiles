# https://console.cloud.google.com/artifacts/docker/gemini-code-dev/us/gemini-cli/sandbox
FROM us-docker.pkg.dev/gemini-code-dev/gemini-cli/sandbox:0.10.0-preview.2

USER root

RUN apt-get update && \
    apt-get install -y \
    git \
    && rm -rf /var/lib/apt/lists/*

RUN curl -LO https://go.dev/dl/go1.24.0.linux-amd64.tar.gz && \
    tar -C /usr/local -xzf go1.24.0.linux-amd64.tar.gz && \
    rm go1.24.0.linux-amd64.tar.gz

RUN curl -LsSf https://astral.sh/uv/install.sh | sh && \
    mv /root/.local/bin/uv /usr/local/bin/uv

ARG CACHEBUST

# COPY ./beads /tmp/beads
# RUN cd /tmp/beads && \
#     /usr/local/go/bin/go build -o /usr/local/bin/bd ./cmd/bd && \
#     rm -rf /tmp/beads

RUN git clone https://github.com/steveyegge/beads /tmp/beads && \
    cd /tmp/beads && \
    /usr/local/go/bin/go build -o /usr/local/bin/bd ./cmd/bd && \
    cd / && \
    rm -rf /tmp/beads

USER 1000
RUN echo "alias bd='bd --no-daemon'" >> ~/.bashrc

RUN bd version

WORKDIR /home/node/dev
